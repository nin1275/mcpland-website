function progressLineUpdate(action) {
  var numberOfSteps = $(".step").length;
  var lineWidth = parseFloat($(".progressLine").attr("width"));
  var newLineWidth = 0;
  if (action == "next") {
    newLineWidth = lineWidth + (100 / numberOfSteps);
  }
  if (action == "prev") {
    newLineWidth = lineWidth - (100 / numberOfSteps);
  }
  $(".progressLine").attr({
    style: "width: " + newLineWidth + "%;",
    width: newLineWidth
  });
}
function checkInstallStatus() {
  $.ajax({
    type: "GET",
    url: "/apps/install/public/ajax/check.php",
    success: function(result) {
      if (result == true) {
        $("#redirect").attr("href", "/dashboard").html("View Dashboard");
      }
      else {
        checkInstallStatus();
      }
    },
    error: function(result) {
      console.log(result);
      $(".alert.alert-danger").css("display", "block").html('An unknown error has occurred. Please contact <strong>LeaderOS</strong>! (ERROR_INSTALL_CHECK)');
    }
  });
}
$(document).ready(function() {
  // Form Disable Enter Key //
  $("#installForm").on("keypress keyup", function(e) {
    var keyCode = e.keyCode || e.which;
    if (keyCode === 13) {
      e.preventDefault();
      return false;
    }
  });
  // INPUT FOCUS EVENT //
  $("input").on("focus", function() {
    $(this).removeClass("input-error");
  });
  // NEXT OR SUBMIT BUTTON CLICK EVENT //
  $(".btn-next, button[type=submit]").on("click", function() {
    var nextStep = true;
    var card = $(this).parents(".card");
    var loader = card.find("#loader");
    var spinner = card.find("#spinner");

    card.find("input").each(function() {
      if ($(this).val() == "") {
        $(this).addClass("input-error animated shake").delay(500).queue(function() {
          $(this).removeClass("animated shake").dequeue();
        });
        nextStep = false;
      } else {
        $(this).removeClass("input-error");
      }
    });

    if (nextStep == true) {
      var step = $(this).attr("index");
      var dataArray = {
        mysqlServer: $("input[name=mysqlServer]").val(),
        mysqlPort: $("input[name=mysqlPort]").val(),
        mysqlUsername: $("input[name=mysqlUsername]").val(),
        mysqlPassword: $("input[name=mysqlPassword]").val(),
        mysqlDatabase: $("input[name=mysqlDatabase]").val(),
        siteSlogan: $("input[name=siteSlogan]").val(),
        siteServerName: $("input[name=siteServerName]").val(),
        siteServerIP: $("input[name=siteServerIP]").val(),
        siteServerVersion: $("input[name=siteServerVersion]").val(),
        sitePasswordType: $("select[name=sitePasswordType]").val(),
        siteMaintenance: $("select[name=siteMaintenance]").val(),
        accountUsername: $("input[name=accountUsername]").val(),
        accountEmail: $("input[name=accountEmail]").val(),
        accountPassword: $("input[name=accountPassword]").val(),
        accountPasswordRe: $("input[name=accountPasswordRe]").val()
      };
      loader.css("height", card.next().find(".card-body").actual("outerHeight") + "px").addClass("is-loading");
      spinner.css("display", "flex");
      $.ajax({
        type: "POST",
        url: "/apps/install/public/ajax/install.php?step=" + step,
        data: dataArray,
        success: function(result) {
          if (result == true) {
            $(".alert.alert-danger").addClass("fadeOut").delay(500).queue(function() {
              $(".alert.alert-danger").removeClass('fadeOut').css("display", "none").dequeue();
            });
            card.css("display", "none").next().css("display", "flex");
            $(".step.active").removeClass("active").addClass("done").next().addClass("active");
            progressLineUpdate("next");
            if (step == 2) {
              checkInstallStatus();
            }
          } else {
            $(".alert.alert-danger").css("display", "block").html(result);
          }
          loader.css("height", "auto").removeClass("is-loading");
          spinner.css("display", "none");
        },
        error: function() {
          $(".alert.alert-danger").css("display", "block").html('An unknown error has occurred. Please contact <strong>LeaderOS</strong>!');
          loader.css("height", "auto").removeClass("is-loading");
          spinner.css("display", "none");
        }
      });
    }
    return false;
  });
  // PREV BUTTON CLICK EVENT //
  $(".btn-prev").on("click", function() {
    var card = $(this).parents(".card");
    card.css("display", "none").prev().css("display", "block");
    $(".step.active").removeClass("active").prev().addClass("active");
    progressLineUpdate("prev");
  });
});

/* CONSOLE MESSAGE */
var consoleCopyrightStyle = [
  "margin: 16px 0",
  "border-radius: 10px"
].join(";");
var consoleWarningHeaderStyle = [
  "color: #ff0000",
  "font-size: 32px",
  "font-weight: 600",
  "margin: 8px 0"
].join(";");
var consoleWarningContentStyle = [
  "background-color: #ff0000",
  "color: #ffffff",
  "padding: 20px",
  "border-radius: 10px"
].join(";");
console.log(
  "%cDUR!"+
  `%cCopyright Â© ${new Date().getFullYear()} LeaderOS v5`,
  consoleWarningHeaderStyle,
  consoleWarningContentStyle,
  consoleCopyrightStyle
);
